---
title: "Holsenbeck_S_8_9"
author: "Stephen Synchronicity"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
always_allow_html: yes
header-includes:
   - \usepackage{dcolumn}
output: 
  html_document: 
    css: C:\Users\Stephen\Documents\R\win-library\3.4\rmarkdown\rmarkdown\templates\neu_hwk\resources\styles.css
    highlight: zenburn
    keep_md: yes
    theme: readable
    toc_float: true
    toc: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE,warning=FALSE,cache=TRUE, fig.align='center', fig.height=3.5, fig.width=5, tidy=TRUE, tidy.opts=list(width.cutoff=80))
rmarkdown::html_dependency_jquery()
rmarkdown::html_dependency_bootstrap("readable")
rmarkdown::html_dependency_jqueryui()
set.seed(1)
```
```{r Libraries, echo=T, results='hide'}
library("tidyverse")
library("dplyr")
library("htmltools")
library("forcats")
library("stargazer")
library("sjPlot")
library("car")
library("bsplus")
```


<button data-toggle="collapse" data-target="#demo" class="btn">Homework Outline</button>
<div id="demo" class="collapse">
1	Describe your substantive interest and the general questions(s) you would like to answer (eg, “Does more education cause people to become more liberal?”). Be sure to frame it in a such a way that you are proposing a hypothesis (or multiple hypotheses) that might be either confirmed or disproven by the results of your analysis.
2	Describe the data set you have found, including its source, its contents, and why it was collected originally.
3	What is your dependent variable? Why are you interested in explaining it? What do you hypothesize are the major factors that influence or cause it?
4	What are your independent variables, and why have you chosen these? Prior to running your regression, what effects do you expect them to have on the dependent variable? Which of these variables do you think a˙ect other of the independent variables, and how might that a˙ect your final results?
5	Explain and show in detail how you rename and recode the variables you are examining, and what units each are measured in.
6	Before running a multiple regression, run a few bivariate regressions of Y on some of your X variables. What do you infer? Which of these do you think might change with the addition of multiple variables?
7	Run your full multiple regression using lm() and present your results using the output from the stargazer R package. Interpret the coefficients. What do they tell you substantively? Which variables seem to have the biggest substantive impact? Which ones could you actually change with some intervention, and how big a di˙erence do you think that could make?
8	How have any of the coefficients changed from the bivariate regressions? What can you infer from that?How do you think your various independent variables interact and a˙ect each other? Try to find an example where a variable appears signficant in the bivariate regression, but not in the full regression. Is this an example of a spurious or a chained causal pathway?
9	How does what you see match, or not, your hypotheses from (4)? Why did/didn’t it match what you expected?
10	What do the R2 and adjusted R2 tell you about your model?
11	How would you use one of the variable selection methods to choose a model with fewer variables? Select one of the methods (either one of the stepwise or criterion-based methods) and show which variables it would lead you to keep. Do you agree with its results?
12	What are your overall conclusions? What are the weaknesses of your results, and how could you improve them with better or different data?
13	Calculations (using R):
a.	Derive the coeÿcients from your regression using the (X0X)−1X0Y formula. (If you run into problems using solve(), try using ginv() instead, which does the same thing but is a bit more robust.)
b.	For one of the coeÿcients, confirm its p value as shown in the regression output using the coeÿcient, its standard error, and pt() in R.
c.	Calculate the R2 and adjusted R2 using R, and confirm that your results match the regression output.
d.	Calulate the F statistic using R and confirm it against the regression output.
14	Add at least one quadratic term into your model and interpret the results. Is it significant? What is the effect of a 1-unit increase in that variable at its mean value?
15	Add at least one interaction term to you model and interpret the results. Is it significant? What is the effect of a 1-unit increase in one of those interacted variables holding the other at its mean value?
16	Test either the model in 14 or the model in 15 using the F test for nested models. That is, estimate the full model with the variable and quadratic term, or the variable and interaction, and then estimate the reduced model without either, and run the F test to establish whether those variables significantly improve your model.
</div>


**Read Data Set 1**
```{r 'Read Data Set 1'}
US <- read_csv("C:\\Users\\Stephen\\Documents\\Northeastern\\PPUA 5301 - Introduction to Computational Statistics\\Homework\\Homework 8_9\\Nutrition__Physical_Activity__and_Obesity_-_Behavioral_Risk_Factor_Surveillance_System.csv")
# names(US)
(Qs <- unique(US$Question))
```

```{r 'Xform Dataset 1',eval=F}
US_Hlth <- US %>% filter(YearStart==2015 & Question %in% c("Percent of adults who engage in no leisure-time physical activity","Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)","Percent of adults aged 18 years and older who have an overweight classification","Percent of adults who report consuming vegetables less than one time daily") & is.na(Gender)==F & !LocationDesc %in% c("Guam","Puerto Rico","National")) %>%
  select(YearStart,LocationDesc, Question, Data_Value,Gender) %>% 
  group_by(LocationDesc, Question) %>%
  arrange(LocationDesc,Question) %>%
  summarize(Perc=mean(Data_Value))
colnames(US_Hlth) <- c("ST","Hlth_M","Perc")
US_Hlth$Hlth_M <- as.factor(US_Hlth$Hlth_M)
US_Hlth$Hlth_M <- US_Hlth$Hlth_M %>% fct_recode("0"="Percent of adults who engage in no leisure-time physical activity","150"="Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)","Veg"="Percent of adults who report consuming vegetables less than one time daily","Wgt"="Percent of adults aged 18 years and older who have an overweight classification")
US_Hlth<- US_Hlth %>% ungroup() %>%  filter(Hlth_M %in% c("0","150","Veg","Wgt")) %>% spread("Hlth_M","Perc")
```
```{r 'Xform Dataset 1 - Revised'}
US_Hlth <- US %>% filter(YearStart==2015 & is.na(Gender)==F & !LocationDesc %in% c("Guam","Puerto Rico","National")) %>%
  select(YearStart,LocationDesc, Question, Data_Value,Gender) %>% 
  group_by(LocationDesc, Question) %>%
  arrange(LocationDesc,Question) %>%
  summarize(Perc=mean(Data_Value))
colnames(US_Hlth) <- c("ST","Hlth_M","Perc")
US_Hlth$Hlth_M <- as.factor(US_Hlth$Hlth_M)
US_Hlth$Hlth_M <- US_Hlth$Hlth_M %>% fct_recode("wgtObs" = "Percent of adults aged 18 years and older who have obesity",
"wgtOvr" = "Percent of adults aged 18 years and older who have an overweight classification",
"conFru" = "Percent of adults who report consuming fruit less than one time daily",
"conVeg" = "Percent of adults who report consuming vegetables less than one time daily",
"actWL" = "Percent of adults who engage in muscle-strengthening activities on 2 or more days a week",
"act150" = "Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)",
"act150WL" = "Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic physical activity and engage in muscle-strengthening activities on 2 or more days a week",
"act300" = "Percent of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)",
"act0" = "Percent of adults who engage in no leisure-time physical activity")
US_Hlth<- US_Hlth %>% ungroup() %>%  spread("Hlth_M","Perc")
```

**Read Dataset 2**
```{r 'Read Dataset 2'}
Party <- tibble::tribble(
                            ~State, ~Republican.lean.Rep., ~No.lean, ~Democrat.lean.Dem., ~Sample.Size,
                         "Alabama",                 "52%",    "13%",               "35%",          511,
                          "Alaska",                 "39%",    "29%",               "32%",          310,
                         "Arizona",                 "40%",    "21%",               "39%",          653,
                        "Arkansas",                 "46%",    "16%",               "38%",          311,
                      "California",                 "30%",    "21%",               "49%",         3697,
                        "Colorado",                 "41%",    "17%",               "42%",          504,
                     "Connecticut",                 "32%",    "18%",               "50%",          377,
                        "Delaware",                 "29%",    "17%",               "55%",          301,
            "District of Columbia",                 "11%",    "15%",               "73%",          303,
                         "Florida",                 "37%",    "19%",               "44%",         2020,
                         "Georgia",                 "41%",    "18%",               "41%",          968,
                          "Hawaii",                 "28%",    "20%",               "51%",          312,
                           "Idaho",                 "49%",    "19%",               "32%",          320,
                        "Illinois",                 "33%",    "19%",               "48%",         1326,
                         "Indiana",                 "42%",    "20%",               "37%",          654,
                            "Iowa",                 "41%",    "19%",               "40%",          330,
                          "Kansas",                 "46%",    "23%",               "31%",          307,
                        "Kentucky",                 "44%",    "13%",               "43%",          439,
                       "Louisiana",                 "41%",    "16%",               "43%",          465,
                           "Maine",                 "36%",    "17%",               "47%",          303,
                        "Maryland",                 "31%",    "14%",               "55%",          644,
                   "Massachusetts",                 "27%",    "17%",               "56%",          704,
                        "Michigan",                 "34%",    "19%",               "47%",          982,
                       "Minnesota",                 "39%",    "15%",               "46%",          563,
                     "Mississippi",                 "44%",    "14%",               "42%",          309,
                        "Missouri",                 "41%",    "18%",               "42%",          642,
                         "Montana",                 "49%",    "21%",               "30%",          312,
                        "Nebraska",                 "47%",    "17%",               "36%",          312,
                          "Nevada",                 "37%",    "18%",               "46%",          314,
                   "New Hampshire",                 "35%",    "20%",               "44%",          303,
                      "New Jersey",                 "30%",    "19%",               "51%",          886,
                      "New Mexico",                 "37%",    "15%",               "48%",          312,
                        "New York",                 "28%",    "19%",               "53%",         1966,
                  "North Carolina",                 "41%",    "17%",               "43%",         1022,
                    "North Dakota",                 "50%",    "18%",               "33%",          338,
                            "Ohio",                 "42%",    "18%",               "40%",         1132,
                        "Oklahoma",                 "45%",    "15%",               "40%",          391,
                          "Oregon",                 "32%",    "21%",               "47%",          419,
                    "Pennsylvania",                 "39%",    "15%",               "46%",         1366,
                    "Rhode Island",                 "30%",    "22%",               "48%",          305,
                  "South Carolina",                 "43%",    "18%",               "39%",          495,
                    "South Dakota",                 "53%",    "10%",               "37%",          305,
                       "Tennessee",                 "48%",    "15%",               "36%",          661,
                           "Texas",                 "39%",    "21%",               "40%",         2535,
                            "Utah",                 "54%",    "16%",               "30%",          315,
                         "Vermont",                 "29%",    "14%",               "57%",          306,
                        "Virginia",                 "43%",    "18%",               "39%",          882,
                      "Washington",                 "33%",    "23%",               "44%",          714,
                   "West Virginia",                 "43%",    "16%",               "41%",          309,
                       "Wisconsin",                 "42%",    "16%",               "42%",          600,
                         "Wyoming",                 "57%",    "18%",               "25%",          316
           )
```
**Xform Dataset 2**
```{r 'Xform Dataset 2'}
Party <- lapply(Party, gsub, pattern='\\%', replacement='')
Party <- as.data.frame(Party,stringsAsFactors = F,)
reclass <- function(df, vec){
  df[] <- Map(function(x, f){
    #switch below shows the accepted values in the vector
    #you can modify it and/or add more
    f <- switch(f,
                as.is  = 'force',
                factor = 'as.factor',
                num    = 'as.numeric',
                char   = 'as.character')
    #takes the name of the function and fetches the function
    f <- get(f)
    #apply the function
    f(x)
  },
      df,
      vec)
df
}
Party <- reclass(Party, c('char','num','num','num','num'))
names(Party)
colnames(Party) <- c("ST","R","N","D","ns")
```

**Join Tables for Analysis**
```{r 'Join Tables for Analysis'}
Pty_Hlth <- left_join(Party,US_Hlth,by="ST")
rm(US_Hlth,Party)
```

**Prelim Analysis - Revised**
```{r 'Prelim Analysis - Revised', fig.width=10,fig.height=5}
Pty_Hlth<- Pty_Hlth %>% arrange(R)
ggact <- ggplot(data=Pty_Hlth,mapping=aes(x=reorder(ST,R),y=`R`))+
  geom_point()+
  geom_point(mapping=aes(y=`actWL`),color="red",size=2)+
  geom_point(mapping=aes(y=`act150`),color="orange",size=2)+
  geom_point(mapping=aes(y=`act150WL`),color="#C42B2D",size=2)+
  geom_point(mapping=aes(y=`act300`),color="blue",size=2)+
  geom_point(mapping=aes(y=`act0`),color="black",size=2)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1,lineheight = 1))
ggwgt <- ggplot(data=Pty_Hlth,mapping=aes(x=reorder(ST,R),y=`R`))+
  geom_point()+
  geom_point(mapping=aes(y=`wgtObs`),color="red",size=2)+
  geom_point(mapping=aes(y=`wgtOvr`),color="#A32D2D",size=2)+
  theme(legend.position="none",axis.text.x = element_text(angle = 90, hjust = 1,lineheight = 1))
ggcon <- ggplot(data=Pty_Hlth,mapping=aes(x=reorder(ST,R),y=`R`))+
  geom_point()+
  geom_point(mapping=aes(y=`conFru`),color="red",size=2)+
  geom_point(mapping=aes(y=`conVeg`),color="#B88037",size=2)+
  theme(legend.position="none",axis.text.x = element_text(angle = 90, hjust = 1,lineheight = 1))
#The Wgt variable is obviously not correlated, so this will be left out of further analyses
ggact
ggwgt
ggcon
```

## 1
<div class="q">	Describe your substantive interest and the general questions(s) you would like to answer (eg, “Does more education cause people to become more liberal?”). Be sure to frame it in a such a way that you are proposing a hypothesis (or multiple hypotheses) that might be either confirmed or disproven by the results of your analysis.
</div>
<div class="a">
Selecting the data for comparison was quite difficult given the restraints of having the data not include temporal or categorical data. All of my interests included data that had a temporal index or categorical data involved. Resolving to include health related measures, I decided to continue with the inquiry from class about partisanship, these two data sets allow for correlation between these topics. The data within fits the restraints and *might* yield interesting correlations.
<br>
The hypothesis is a question of whether there is a correlation between various health behaviors and party affiliation within states.
*After Revision*  
$H_1$ Is the "Percent of adults aged 18 years and older who have obesity" correlated with the % identifying as Republican? If so, what is the sign of $\beta_1$?
<br>
$H_2$ Is the "Percent of adults who report consuming fruit less than one time daily" correlated with the % identifying as Republican? If so, what is the sign of $\beta_2$?
<br>
$H_3$ Is the "Percent of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)" a predictor variable for the % identifying as Republican? If so what is the sign of $\beta_3$?
</div>
## 2
<div class="q">	Describe the data set you have found, including its source, its contents, and why it was collected originally.
</div>
<div class="a">
The data health behaviors and risk factors is a subset of the <a href="https://catalog.data.gov/dataset/nutrition-physical-activity-and-obesity-behavioral-risk-factor-surveillance-system" target="_blank">Nutrition, Physical Activity, and Obesity - Behavioral Risk Factor Surveillance System data set</a><sup>1</sup> from the CDC. The data is gathered to track behavioral risk factors across different demographic strata by state.
<br>
The data about party affilation by state came from the <a href="http://www.pewforum.org/religious-landscape-study/compare/party-affiliation/by/state/" target="_blank">Party affiliation by State (2014)</a><sup>2</sup> data set provided by the Pew Research Center. This particular data was originally collected as part of the <a href="http://www.pewforum.org/religious-landscape-study/" target="_blank">Religious Landscape Study</a><sup>3</sup>
<blockquote style="font-size:0.5em">
<sup>1</sup>https://catalog.data.gov/dataset/nutrition-physical-activity-and-obesity-behavioral-risk-factor-surveillance-system
<br>
<sup>2</sup>http://www.pewforum.org/religious-landscape-study/compare/party-affiliation/by/state/
<br>
<sup>3</sup>http://www.pewforum.org/religious-landscape-study/
</blockquote>
</div>
## 3
<div class="q">	What is your dependent variable? Why are you interested in explaining it? What do you hypothesize are the major factors that influence or cause it?
</div>
<div class="a">The dependent variable is the percentage of the state pop. identified as Republican, or Republican leaning. The variable is complex with numerous influencing factors. During the in-class explorations we have looked at potential influencing factors such as race, income, and education level on party affiliation via data from the ANES survey.
<br>
Intuitively, party affiliation could also be influenced or predicted in part by religion, affiliation of parents, place of residence, affiliation of one's peers in one's social network. It could also be related to psychological traits, or, as we will explore, health behaviors.
<br>
In this study, we'll be looking at the percentage of each state's pop. exhibiting particular health behaviors, these behaviors will be described in further detail below. An individual presenting a risk factor of obesity might also have a lack of exposure to quality health related information during ther time in the education system and/or lack of exposure to quality health related information sources at present. The diagnosis could also be related to lack of access to health care services and medical professionals etc. If a person is living a lifestyle that involves behaviors identified as risk factors, there are often concurrent cognitive indicators resulting from poor health. 
<br>For example, there's evidence relating <a href="https://scholar.google.com/scholar?q=physical+exercise+and+executive+function&hl=en&as_sdt=0&as_vis=1&oi=scholart&sa=X&ved=0ahUKEwiDprWHwKvXAhWD5iYKHatJCmAQgQMIJDAA" target="_blank">physical exercise and executive function</a><sup>4</sup>, and <a href="https://scholar.google.com/scholar?hl=en&as_sdt=0%2C22&as_vis=1&q=physical+activity+on+cognition&oq=physical+exercise+and+executive+function" target="_blank">physical exercise to cognition</a><sup>5</sup>. Thus, there might be some explanatory value in relating activity levels (or lack thereof) to political party affiliation that would undoubtedly be controversial if the evidence exists. 
With regard to whether or not the "Percent of adults who report consuming fruit less than one time daily" influences the percent of the state pop. identifying as Republican it is likely that the two are not related. Thugh the variable might not have much explanatory value, it was the only variable from the dietary behaviors questions that did not exhibit colinearity with variables from the other classes.
<blockquote style="font-size:0.5em">
<sup>4</sup>https://scholar.google.com/scholar?q=physical+exercise+and+executive+function&hl=en&as_sdt=0&as_vis=1&oi=scholart&sa=X&ved=0ahUKEwiDprWHwKvXAhWD5iYKHatJCmAQgQMIJDAA
<br>
<sup>5</sup>https://scholar.google.com/scholar?hl=en&as_sdt=0%2C22&as_vis=1&q=physical+activity+on+cognition&oq=physical+exercise+and+executive+function
</blockquote>
</div>
## 4
<div class="q">	What are your independent variables, and why have you chosen these? Prior to running your regression, what effects do you expect them to have on the dependent variable? Which of these variables do you think affect other of the independent variables, and how might that affect your final results?
</div>
<div class="a">
<blockquote>*Original*  
This brief analysis will look at whether there is correlation between the following independent variables:
<ul style="list-style-type:none">
<li>$x_1$: % of pop. living sedentary lifestyle</li>
<li>$x_2$: % of pop. living lifestyle meeting minimum physical activity recommendations</li>
<li>$x_3$: % of pop. that consumes vegetables less than 1 time daily</li>
</ul>
and the dependent variable $y$: the identification as Republican.
<br>
There might be a positive correlation between the percent of a state's pop. that exhibits health behaviors identified as risk factors $x_1,x_3$ and the percent of a state's pop. that identifies as Republican or Republican leaning. There is likely an inverse colinear relationship between $x_1$ and $x_2$ because they are mutually exclusive categories along a scale of 5 categories (not all of which are mutually exclusive.) See variable Qs, for the original categories. There could also be a correlation between states with a larger percentage of the population meeting minimum physical activity recommendations, and those whom are consuming vegetables more than 1 time a day, due to a theoretical common variable of health knowledge.</blockquote>
*After Revision*
This brief analysis will look at whether there is correlation between the following independent variables:
<ul style="list-style-type:none">
<li>$x_1$: % of adults aged 18 years and older who have obesity</li>
<li>$x_2$: % of adults who report consuming fruit less than one time daily</li>
<li>$x_3$: % of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)</li>
</ul>
and the dependent variable $y$: the percent of the state pop. identifying as Republican.
The % of adults aged 18 years and older who have obesity ($x_1$) might correlate positively with the % of the state pop. identified as Republican. The % of adults who report consuming fruit less than one time daily will likely have no correlation with % of the state pop. identified as Republican. There might be a negative correlation between % of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination). However, the latter two variables are likely more related to the latitude, and longitude of a state (as a predictor of outdoor weather patterns conducive to outdoor activity), as well as the popularity and diversity of various athletic recreational activities within the state.
</div>
## 5
<div class="q">	Explain and show in detail how you rename and recode the variables you are examining, and what units each are measured in.
</div>
<div class="a">
The variables have been recoded in the chunks entitled "Xform Dataset 1 - Revised" & "Xform Dataset 2." The renaming and recoding procedures are explained below:
<br>
*Dataset 1*  
The data is filtered for the year 2015, the only year with data for each question that is closest to the year in which the data was gathered in dataset 2, the relevant questions, the 50 states plus the District of Columbia (as in dataset 2), and the gender stratification. The "Questions" column from the original dataset is renamed Hlth_M (Health Measures). The percentages of the pop. reporting a yes to the question are filtered by the gender stratification, such that only 2 percentages need be averaged to get a single % for the entire population. The answers to the questions are then recoded using the forcats package, see the chunk entitled Xform Dataset 1 - Revised for details on variable names. The factors are then spread into columns.
<br>
*Dataset 2*  
The dataset variables were transformed as follows:
<ol>
<li>R="Republican/Republican Leaning"</li>
<li>D="Democrat/Democrat Leaning"</li>
<li>N="No affiliation"</li>
</ol>
The variables were reclassed to characters or numbers where necessary. The tables are joined by State.
All variables are measured in % of state population.
</div>

## 6
<div class="q">	Before running a multiple regression, run a few bivariate regressions of Y on some of your X variables. What do you infer? Which of these do you think might change with the addition of multiple variables?
</div>
<div class="a">
<blockquote>
*These linear regressions without results contained in this blockquote were used to identify that the variables in question were colinear. The assignment was then revised. The revised answer to this question begins where the blockquote ends.*
```{r '2-Var Regressions',eval=F}
`r0`<- summary(lm(`R`~`0`,Pty_Hlth))
`r150`<- summary(lm(`R`~`150`,Pty_Hlth))
`rv`<- summary(lm(`R`~`Veg`,Pty_Hlth))
`150v0` <- summary(lm(`0`~`150`,Pty_Hlth))
`150v0`
```
<p>Before running a multiple regression, run a few bivariate regressions of Y on some of your X variables. What do you infer? Which of these do you think might change with the addition of multiple variables?
<br>
While there is statistical significance at the 95% confidence level in the correlations between R and 150, and Veg, it can also be noted the $R^2$ values indicate that little of the variation is explained by the model. As variables are added in a multiple variable regression, the $R^2$ value will inevitably increase, though it is important to note the low $R^2$ in these 2-Variable models.
<br>
The comparison of `0` and `150` show that the variables are indeed colinear, and will be confounding variables if combined. It may be necessary to add an additional health variable that is not colinear with any of the other variables.</p>
```{r 'Add Statistic on Obesity for Multiple Linear Regression',eval=F}
USob <- US %>% filter(YearStart==2015 & Question %in% c("Percent of adults aged 18 years and older who have obesity") & is.na(Gender)==F & !LocationDesc %in% c("Guam","Puerto Rico","National")) %>%
  select(YearStart,LocationDesc, Question, Data_Value,Gender) %>% 
  group_by(LocationDesc, Question) %>%
  arrange(LocationDesc,Question) %>%
  summarize(Perc=mean(Data_Value))
USob <- USob[,-2]
names(USob) <- c("ST","Ob")
Pty_Hlth <- left_join(Pty_Hlth,USob,by="ST")
ROb <- summary(lm(`R`~`Ob`,Pty_Hlth))
ROb
rm(USob)
`0Ob` <- summary(lm(`0`~`Ob`,Pty_Hlth))
`0Ob`
```

It appears that obesity is also colinear with a sedentary lifestyle, logically, this linkage makes sense. Let's have a look at the fruit variable.
```{r 'Add Fruit Variable',eval=F}
USF <- US %>% filter(YearStart==2015 & Question %in% c("Percent of adults who report consuming fruit less than one time daily") & is.na(Gender)==F & !LocationDesc %in% c("Guam","Puerto Rico","National")) %>%
  select(YearStart,LocationDesc, Question, Data_Value,Gender) %>% 
  group_by(LocationDesc, Question) %>%
  arrange(LocationDesc,Question) %>%
  summarize(Perc=mean(Data_Value))
USF <- USF[,-2]
names(USF) <- c("ST","Fruit")
Pty_Hlth <- left_join(Pty_Hlth,USF,by="ST")
(VF <- summary(lm(Veg~Fruit,Pty_Hlth)))
#Colinear
(F150 <- summary(lm(Fruit~`150`,Pty_Hlth)))
#Colinear
(FOb <- summary(lm(Fruit~Ob,Pty_Hlth)))
#Colinear```
```
Healthy lifestyle traits show high degrees of correlation, while risk factors are also highly correlated. 
```{r 'Add Weight Lifting Variable',eval=F}
USWl <- US %>% filter(YearStart==2015 & Question %in% c("Percent of adults who engage in muscle-strengthening activities on 2 or more days a week") & is.na(Gender)==F & !LocationDesc %in% c("Guam","Puerto Rico","National")) %>%
  select(YearStart,LocationDesc, Question, Data_Value,Gender) %>% 
  group_by(LocationDesc, Question) %>%
  arrange(LocationDesc,Question) %>%
  summarize(Perc=mean(Data_Value))
USWl <- USWl[,-2]
names(USWl) <- c("ST","Wl")
Pty_Hlth <- left_join(Pty_Hlth,USWl,by="ST")
(VFWl <- summary(lm(Veg~Wl,Pty_Hlth)))
#Colinear
(Wl150 <- summary(lm(Wl~`150`,Pty_Hlth)))
#Colinear
(WlOb <- summary(lm(Wl~Ob,Pty_Hlth)))
#Colinear
```

It appears that it will be necessary to start back at the beginning, extract all of the health related questions, spread them to individual variables and graph them. By graphing all of the variables it may allow them to be differentiated to avoid colinearity.</blockquote>
*After Revision*  
After revision, the three variables that appear not to be colinear are:
<ol>
<li>"% of adults aged 18 years and older who have obesity", <u>wgtObs</u></li>
<li>"% of adults who report consuming fruit less than one time daily", <u>conFru</u></li>
<li>"% of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)", <u>act300</u></li>
</ol>

```{r '2-Variable Regressions - Revised',results='asis'}
Obs150 <- lm(wgtObs~act150,Pty_Hlth)
ObsFru <- lm(wgtObs~conFru,Pty_Hlth)
Obs300 <- lm(wgtObs~act300,Pty_Hlth)
Fru300 <- lm(conFru~act300,Pty_Hlth)
RObs <- lm(R~wgtObs,Pty_Hlth)
RFru <- lm(R~conFru,Pty_Hlth)
R300 <- lm(R~act300,Pty_Hlth)

stargazer(Obs150, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
stargazer(ObsFru, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
stargazer(Obs300, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
stargazer(Fru300, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
stargazer(RFru, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
stargazer(RObs, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
stargazer(R300, no.space=TRUE,omit.stat=c("ll"),header=FALSE,type="html")
```

The $R^2$ values appear to be low enough where the degree of multicollinearity will not be so substantial as to render the predictive value of the model inaccurate. With the addition of multiple variables, the signficance of the individual health behavioral variables will likely decrease. The $R^2$ will also decrease as the amount of variance will be cumulative as more variables are added to the model.
</div>
## 7
<div class="q">	Run your full multiple regression using lm() and present your results using the output from the stargazer R package. 
<ol style="list-style-type: lower-alpha">
<li>Interpret the coefficients. What do they tell you substantively?</li>
<li>Which variables seem to have the biggest substantive impact?</li>
<li>Which ones could you actually change with some intervention, and how big a difference do you think that could make?</li>
</ol>  
</div>
<div class="a">
```{r '7'}
RObs300Fru <- lm(R~wgtObs+conFru+act300,Pty_Hlth)
vif(RObs300Fru)
sjt.lm(RObs300Fru)

# stargazer(RObs300Fru) for PDF
# stargazer(R150VegObs)
```

```{r '7 - Stargazer',results='asis'}
stargazer(RObs300Fru, no.space=TRUE, dep.var.labels=c("% identified as Republican"), 
          omit.stat=c("ll"),header=FALSE,type="html")
```

### a
<p>
The variables from the revision: <u>wgtObs</u>,<u>conFru</u>, and <u>act300</u> are modeled, and the variables from the originally intended linear model: <u>wgtObs</u>,<u>conVeg</u>, and <u>act150</u> are modeled for comparison purposes. 
<br>
<br>
*Coefficients*  
$$\begin{aligned} Y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + \epsilon \end{aligned}$$
Where:  
<ul style="list-style-type:none">
<li>$x_1$: % of adults aged 18 years and older who have obesity</li>
<li>$x_2$: % of adults who report consuming fruit less than one time daily</li>
<li>$x_3$: % of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)</li>
</ul>
The $\beta$ coefficient for a given variable indicates that for a unit increment in that variable, the resulting value $\hat{y}$ will be incremented by the value of $\beta$.  

### b  
*Variables with Substantive Impact*  
The <u>conFru</u> variable in linear model <u>RObs300Fru</u> comes close to being significant at the 95% confidence level, though the adjusted $R^2$ value for the model is .267. The <u>wgtObs</u> variable in the <u>R150VegObs</u> model is significant at the 99% confidence level, but the adjusted $R^2$ value for the model is lower at .235. Given these outcomes, the model is not going to provide an accurate predictive model for the dependent variable.

### c  
*Treatment Scenario to Control Independent Variables*  
Each of the independent variables are health behaviors, and/or risk factors. An intervention in influence the variable might be implementing mandatory nutrition & health education in grades K-12. If upon graduation, graduates were offered access to insurance coverage conditional with premiums ranging from deeply discounted to full price based on a spectrum of compliance with exercise and diet guidelines determined from statistical averages across the state, then you might be able to substantially drive down the rates of risk factors, and the percentages of people with risk-bearing health behaviors. If it was noted that a steep decline in the aforementioned variables did occur to the degree that it was statistically significant, it could be investigated whether there was also a significant drop in the % of people identifying as Republican. By controlling the health related variables more directly it will show whether party affiliation is effected.
<br>
*Survey Intervention*  
If there was a survey conducted with a statistically significant sample of a given population (such as within a state) in which individuals were asked about party affiliation in addition to data on health behaviors, as in the CDC study, it would be a straightforward process to run statistical analyses on the health behavior/risk factor question answers stratified by party affiliation. Maybe the CDC would be up for adding a question to their survey?
</div>

## 8
<div class="q">	
<ol style="list-style-type:lower-alpha">
<li>How have any of the coefficients changed from the bivariate regressions? </li>
<li>What can you infer from that? </li>
<li>How do you think your various independent variables interact and affect each other? </li>
<li>Try to find an example where a variable appears significant in the bivariate regression, but not in the full regression. Is this an example of a spurious or a chained causal pathway?</li>
</ol>
</div>
<div class="a">
### a  
```{r '8a'}
RFru$coefficients
RObs$coefficients
R300$coefficients
RObs300Fru$coefficients
```

This coefficients have dropped in value from the bivariate to the multivariate.  Also, we can see that including all three of these variables has mitigated the negative correlaton with act300 and actually made it a positive correlation. This does not seem to be a spurious or chained causal pathway, but rather the influence of two positively correlated values and one negatively correlated value included in the same linear model.

### b  
It can be inferred, that were variables with all positive correlations chosen for the multivariate regression, a more pronounced positive effect on the coefficients will be observed. To test this, we can add <u>act0</u> - "Percent of adults who engage in no leisure-time physical activity" to the model. It is expected that due to the likely multicolinearity between this variable and <u>wgtObs</u>, we will observe larger coefficients, increased significance, but also a high VIF. To test:
```{r '8b'}
RObsFru0 <- lm(R~wgtObs+conFru+act0,Pty_Hlth)
#stargazer(RObsFru0,type="html")
RObs300Fru$coefficients
RObsFru0$coefficients
vif(RObsFru0)
R0 <- lm(R~act0,Pty_Hlth)
R0$coefficients
```
As inferred, the coefficients did increase in value, as did the VIF scores. However, unexpectedly, the act0 coefficient is negative, even though it is positive in the bivariate regression with the dependent variable, and with its other IVs. The y-intercept shifted dramatically between the two models, which could indicate that when individuals in act300 are included, the % of individuals identifying as Republican starts at a much lower percent, and goes up by small amounts with each unit shift in the IVs, whereas when act0 is included, there is a larger % of those identifying as Republican, which goes down by 0.71 with each unit shift in X. Admittedly, these results are confusing, and this is just a conjecture.

### c  
```{r '8c'}
vif(RObs300Fru)
```

*VIF*  
<p>According to this <a href="https://statisticalhorizons.com/multicollinearity" target="_blank">resource</a><sup>6</sup>, the VIF is a multiplier by which the variance could be inflated due to multicollinearity. From our VIF values, we can see that the variance could be significantly inflated in the models due to multicollinearity. Looking at the values for VIF between the models, it appears that the variables in <u>R150VegObs</u> (the originally proposed model) have more distributed multicollinearity between them than in the original model, though the multicollinearity between wgtObs and R in the revised model is more pronounced. </p>
<p>By evaluating the variables, it's apparent that <u>wgtObs</u> and <u>act300</u> are going to be mutually exclusive, and likely going to dampen the coefficients and significance of one another when included in the same model. We can confirm this by adding all variables that are likely to all be correlated:</p>
```{r '8c - cont'}
R0VegObs <- lm(R~act0+conVeg+wgtObs,Pty_Hlth)
vif(R0VegObs)
summary(R0VegObs)
```

<p>
The overall p-value for the model is now statistically significant, as well as for the coefficient of <u>wgtObs</u>. The coefficients are higher in value, and the $R^2$ is similar to other models. What still remains confusing is the negative coefficient for  <u>act0</u>, which when regressed with wgtObs and conVeg, and R individually, are all positive.</p>
```{r}
Veg0 <- lm(act0~conVeg,Pty_Hlth)
Obs0 <- lm(act0~wgtObs,Pty_Hlth)
Veg0$coefficients
Obs0$coefficients
R0$coefficients
```


<blockquote style="font-size:0.5em">
<sup>6</sup>https://statisticalhorizons.com/multicollinearity
</blockquote>

### d  
The bivariate models indicate numerous statistically significant correlations:
```{r '8d',eval=F}
summary(RFru)
summary(RObs)
summary(R300)
```

None of which are reflected in the multivariate regression, likely due to the reasons mentioned in the previous answer regarding inverse relationships and resulting dampening of the coefficient values. There may be confounding variables between <u>conFru</u> and <u>wgtObs</u>. If all risk factors and healthy behaviors were grouped together respectively, variables delineating each might be overall health knowledge, access to health information etc. as discussed prior. There is definite mutual exclusivity between <u>wgtObs</u> and <u>act300</u>, which isn't spurious or chained but important to note. It could logically be conceived that <u>act0</u> and <u>wgtObs</u> would be chained in causation, but the results from previous answers make this relationship difficult to discern.
</div>

## 9  
<div class="q">	How does what you see match, or not, your hypotheses from (4)? Why did/didn’t it match what you expected?</div>
<div class="a">
The hypothesis from (4) is not supported by the multivariate regression analyses
explored above. The hypothesis was a stretch to begin with, and more a result of trying to fit the two datasets into a hypothesis test. The data didn't fit the hypothesis likely because the logic that lead to the hypothesis was coarse, and the datasets are not ideal for actually exploring these hypotheses. A more direct way of exploring the hypothesis would be the survey intervention proposed in 7c.</div>

## 10
<div class="q">	What do the $R^2$ and adjusted $R^2$ tell you about your model?</div>
<div class="a">
```{r '10'}
sumRFO3 <- summary(RObs300Fru)
sumRFO3$r.squared
sumRFO3$adj.r.squared
```
The $R^2$ value indicates that ~.31% of the variance in R is explained by the IV's included in the model. The Adjusted $R^2$ is more accurate for this multivariate analysis as it accounts for the number of variables included in the model. 
</div>

## 11
<div class="q">	How would you use one of the variable selection methods to choose a model with fewer variables? Select one of the methods (either one of the stepwise or criterion-based methods) and show which variables it would lead you to keep. Do you agree with its results?
</div>
<div class="a">
</div>
## 12
<div class="q">	What are your overall conclusions? What are the weaknesses of your results, and how could you improve them with better or different data?
</div>
<div class="a">
</div>
## 13
<div class="q">	Calculations (using R):
a.	Derive the coefficients from your regression using the (X0X)−1X0Y formula. (If you run into problems using solve(), try using ginv() instead, which does the same thing but is a bit more robust.)
b.	For one of the coefficients, confirm its p value as shown in the regression output using the coeffcient, its standard error, and pt() in R.
c.	Calculate the R2 and adjusted R2 using R, and confirm that your results match the regression output.
d.	Calulate the F statistic using R and confirm it against the regression output.
</div>
<div class="a">
</div>
## 14
<div class="q">	Add at least one quadratic term into your model and interpret the results. Is it significant? What is the effect of a 1-unit increase in that variable at its mean value?</div>
<div class="a">
</div>
## 15
<div class="q">	Add at least one interaction term to you model and interpret the results. Is it significant? What is the effect of a 1-unit increase in one of those interacted variables holding the other at its mean value?</div>
<div class="a">
</div>
## 16
<div class="q">	Test either the model in 14 or the model in 15 using the F test for nested models. That is, estimate the full model with the variable and quadratic term, or the variable and interaction, and then estimate the reduced model without either, and run the F test to establish whether those variables significantly improve your model.</div>
<div class="a">
</div>
```{r}
Obs0 <- lm(wgtObs~act0,Pty_Hlth)
summary(Obs0)
```

