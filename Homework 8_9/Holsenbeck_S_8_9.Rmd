---
title: "Holsenbeck_S_8_9"
author: "Stephen Synchronicity"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
always_allow_html: yes
header-includes:
   - \usepackage{dcolumn}
output: 
  html_document: 
    css: C:\Users\Stephen\Documents\R\win-library\3.4\rmarkdown\rmarkdown\templates\neu_hwk\resources\styles.css
    highlight: zenburn
    keep_md: yes
    theme: readable
    toc_float: true
    toc: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE,warning=FALSE,cache=TRUE, fig.align='center', fig.height=3.5, fig.width=5, tidy=TRUE, tidy.opts=list(width.cutoff=80))
rmarkdown::html_dependency_jquery()
rmarkdown::html_dependency_bootstrap("readable")
rmarkdown::html_dependency_jqueryui()
set.seed(1)
```
```{r Libraries, echo=FALSE, results='hide'}
library("tidyverse")
library("dplyr")
library("htmltools")
library("stringr")
library("forcats")
library("gridExtra")
library("magrittr")
```


<button data-toggle="collapse" data-target="#demo" class="btn">Homework Outline</button>
<div id="demo" class="collapse">
1	Describe your substantive interest and the general questions(s) you would like to answer (eg, “Does more education cause people to become more liberal?”). Be sure to frame it in a such a way that you are proposing a hypothesis (or multiple hypotheses) that might be either confirmed or disproven by the results of your analysis.
2	Describe the data set you have found, including its source, its contents, and why it was collected originally.
3	What is your dependent variable? Why are you interested in explaining it? What do you hypothesize are the major factors that influence or cause it?
4	What are your independent variables, and why have you chosen these? Prior to running your regression, what effects do you expect them to have on the dependent variable? Which of these variables do you think a˙ect other of the independent variables, and how might that a˙ect your final results?
5	Explain and show in detail how you rename and recode the variables you are examining, and what units each are measured in.
6	Before running a multiple regression, run a few bivariate regressions of Y on some of your X variables. What do you infer? Which of these do you think might change with the addition of multiple variables?
7	Run your full multiple regression using lm() and present your results using the output from the stargazer R package. Interpret the coefficients. What do they tell you substantively? Which variables seem to have the biggest substantive impact? Which ones could you actually change with some intervention, and how big a di˙erence do you think that could make?
8	How have any of the coefficients changed from the bivariate regressions? What can you infer from that?How do you think your various independent variables interact and a˙ect each other? Try to find an example where a variable appears signficant in the bivariate regression, but not in the full regression. Is this an example of a spurious or a chained causal pathway?
9	How does what you see match, or not, your hypotheses from (4)? Why did/didn’t it match what you expected?
10	What do the R2 and adjusted R2 tell you about your model?
11	How would you use one of the variable selection methods to choose a model with fewer variables? Select one of the methods (either one of the stepwise or criterion-based methods) and show which variables it would lead you to keep. Do you agree with its results?
12	What are your overall conclusions? What are the weaknesses of your results, and how could you improve them with better or different data?
13	Calculations (using R):
a.	Derive the coeÿcients from your regression using the (X0X)−1X0Y formula. (If you run into problems using solve(), try using ginv() instead, which does the same thing but is a bit more robust.)
b.	For one of the coeÿcients, confirm its p value as shown in the regression output using the coeÿcient, its standard error, and pt() in R.
c.	Calculate the R2 and adjusted R2 using R, and confirm that your results match the regression output.
d.	Calulate the F statistic using R and confirm it against the regression output.
14	Add at least one quadratic term into your model and interpret the results. Is it significant? What is the effect of a 1-unit increase in that variable at its mean value?
15	Add at least one interaction term to you model and interpret the results. Is it significant? What is the effect of a 1-unit increase in one of those interacted variables holding the other at its mean value?
16	Test either the model in 14 or the model in 15 using the F test for nested models. That is, estimate the full model with the variable and quadratic term, or the variable and interaction, and then estimate the reduced model without either, and run the F test to establish whether those variables significantly improve your model.
</div>


**Read Data Set 1**
```{r 'Read Data Set 1'}
US <- read_csv("C:\\Users\\Stephen\\Documents\\Northeastern\\PPUA 5301 - Introduction to Computational Statistics\\Homework\\Homework 8_9\\Nutrition__Physical_Activity__and_Obesity_-_Behavioral_Risk_Factor_Surveillance_System.csv")
# names(US)
(Qs <- unique(US$Question))
```

```{r 'Xform Datatset 1'}
US_Hlth <- US %>% filter(YearStart==2015 & Question %in% c("Percent of adults who engage in no leisure-time physical activity","Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)","Percent of adults aged 18 years and older who have an overweight classification","Percent of adults who report consuming vegetables less than one time daily") & is.na(Gender)==F & !LocationDesc %in% c("Guam","Puerto Rico","National")) %>%
  select(YearStart,LocationDesc, Question, Data_Value,Gender) %>% 
  group_by(LocationDesc, Question) %>%
  arrange(LocationDesc,Question) %>%
  summarize(Perc=mean(Data_Value))
colnames(US_Hlth) <- c("ST","Hlth_M","Perc")
US_Hlth$Hlth_M <- as.factor(US_Hlth$Hlth_M)
US_Hlth$Hlth_M <- US_Hlth$Hlth_M %>% fct_recode("0"="Percent of adults who engage in no leisure-time physical activity","150"="Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)","Veg"="Percent of adults who report consuming vegetables less than one time daily","Wgt"="Percent of adults aged 18 years and older who have an overweight classification")
US_Hlth<- US_Hlth %>% ungroup() %>%  filter(Hlth_M %in% c("0","150","Veg","Wgt")) %>% spread("Hlth_M","Perc")
```

**Read Dataset 2**
```{r 'Read Dataset 2'}
Party <- tibble::tribble(
                            ~State, ~Republican.lean.Rep., ~No.lean, ~Democrat.lean.Dem., ~Sample.Size,
                         "Alabama",                 "52%",    "13%",               "35%",          511,
                          "Alaska",                 "39%",    "29%",               "32%",          310,
                         "Arizona",                 "40%",    "21%",               "39%",          653,
                        "Arkansas",                 "46%",    "16%",               "38%",          311,
                      "California",                 "30%",    "21%",               "49%",         3697,
                        "Colorado",                 "41%",    "17%",               "42%",          504,
                     "Connecticut",                 "32%",    "18%",               "50%",          377,
                        "Delaware",                 "29%",    "17%",               "55%",          301,
            "District of Columbia",                 "11%",    "15%",               "73%",          303,
                         "Florida",                 "37%",    "19%",               "44%",         2020,
                         "Georgia",                 "41%",    "18%",               "41%",          968,
                          "Hawaii",                 "28%",    "20%",               "51%",          312,
                           "Idaho",                 "49%",    "19%",               "32%",          320,
                        "Illinois",                 "33%",    "19%",               "48%",         1326,
                         "Indiana",                 "42%",    "20%",               "37%",          654,
                            "Iowa",                 "41%",    "19%",               "40%",          330,
                          "Kansas",                 "46%",    "23%",               "31%",          307,
                        "Kentucky",                 "44%",    "13%",               "43%",          439,
                       "Louisiana",                 "41%",    "16%",               "43%",          465,
                           "Maine",                 "36%",    "17%",               "47%",          303,
                        "Maryland",                 "31%",    "14%",               "55%",          644,
                   "Massachusetts",                 "27%",    "17%",               "56%",          704,
                        "Michigan",                 "34%",    "19%",               "47%",          982,
                       "Minnesota",                 "39%",    "15%",               "46%",          563,
                     "Mississippi",                 "44%",    "14%",               "42%",          309,
                        "Missouri",                 "41%",    "18%",               "42%",          642,
                         "Montana",                 "49%",    "21%",               "30%",          312,
                        "Nebraska",                 "47%",    "17%",               "36%",          312,
                          "Nevada",                 "37%",    "18%",               "46%",          314,
                   "New Hampshire",                 "35%",    "20%",               "44%",          303,
                      "New Jersey",                 "30%",    "19%",               "51%",          886,
                      "New Mexico",                 "37%",    "15%",               "48%",          312,
                        "New York",                 "28%",    "19%",               "53%",         1966,
                  "North Carolina",                 "41%",    "17%",               "43%",         1022,
                    "North Dakota",                 "50%",    "18%",               "33%",          338,
                            "Ohio",                 "42%",    "18%",               "40%",         1132,
                        "Oklahoma",                 "45%",    "15%",               "40%",          391,
                          "Oregon",                 "32%",    "21%",               "47%",          419,
                    "Pennsylvania",                 "39%",    "15%",               "46%",         1366,
                    "Rhode Island",                 "30%",    "22%",               "48%",          305,
                  "South Carolina",                 "43%",    "18%",               "39%",          495,
                    "South Dakota",                 "53%",    "10%",               "37%",          305,
                       "Tennessee",                 "48%",    "15%",               "36%",          661,
                           "Texas",                 "39%",    "21%",               "40%",         2535,
                            "Utah",                 "54%",    "16%",               "30%",          315,
                         "Vermont",                 "29%",    "14%",               "57%",          306,
                        "Virginia",                 "43%",    "18%",               "39%",          882,
                      "Washington",                 "33%",    "23%",               "44%",          714,
                   "West Virginia",                 "43%",    "16%",               "41%",          309,
                       "Wisconsin",                 "42%",    "16%",               "42%",          600,
                         "Wyoming",                 "57%",    "18%",               "25%",          316
           )
```
**Xform Dataset 2**
```{r 'Xform Dataset 2'}
Party <- lapply(Party, gsub, pattern='\\%', replacement='')
Party <- as.data.frame(Party,stringsAsFactors = F,)
reclass <- function(df, vec){
  df[] <- Map(function(x, f){
    #switch below shows the accepted values in the vector
    #you can modify it and/or add more
    f <- switch(f,
                as.is  = 'force',
                factor = 'as.factor',
                num    = 'as.numeric',
                char   = 'as.character')
    #takes the name of the function and fetches the function
    f <- get(f)
    #apply the function
    f(x)
  },
      df,
      vec)
df
}
Party <- reclass(Party, c('char','num','num','num','num'))
names(Party)
colnames(Party) <- c("ST","R","N","D","ns")
```

**Join Tables for Analysis**
```{r 'Join Tables for Analysis'}
Pty_Hlth <- left_join(Party,US_Hlth,by="ST")
rm(US,US_Hlth,Party)
```

**Prelim Analysis**
```{r 'Prelim Analysis', fig.width=10,fig.height=5}
Pty_Hlth<- Pty_Hlth %>% arrange(R)
ggplot(data=Pty_Hlth,mapping=aes(x=reorder(ST,R),y=`R`))+
  geom_point()+
  geom_smooth(method="lm")+
  geom_point(mapping=aes(y=`0`),color="red")+
  geom_point(mapping=aes(y=`150`),color="blue")+
  geom_point(mapping=aes(y=`Veg`),color="green")+
  geom_point(mapping=aes(y=`Wgt`),color="orange")+
  theme(legend.position="none",axis.text.x = element_text(angle = 90, hjust = 1,lineheight = 1))
#The Wgt variable is obviously not correlated, so this will be left out of further analyses
```

## 1
<div class="q">	Describe your substantive interest and the general questions(s) you would like to answer (eg, “Does more education cause people to become more liberal?”). Be sure to frame it in a such a way that you are proposing a hypothesis (or multiple hypotheses) that might be either confirmed or disproven by the results of your analysis.
</div>
<div class="a">
Selecting the data for comparison was quite difficult given the restraints of having the data not include temporal or categorical data. All of my interests included data that had a temporal index or categorical data involved. I wanted to look at health related measures, and decided to carry on the question from the class theme about partisanship, hence the topic of the two datasets. The data used herein fits the restraints and *might* prove to yield interesting correlations.
<br>
The hypothesis is a question of whether there is a correlation between various health behaviors and party affiliation within states.
$H_1$ Is the proportion of individuals living a sedentary lifestyle correlated with a party affilation?
$H_2$ Is the proportion of individuals meeting minimum recommendations for physical activity correlated with a party affilation?
$H_3$ Is the proportion of individuals exercising well beyond minimum recommendations for physical activity correlated with a party affilation?
</div>
## 2
<div class="q">	Describe the data set you have found, including its source, its contents, and why it was collected originally.
</div>
<div class="a">
The data with proportion of the poulation living a lifestyle is a subset of the <a href="https://catalog.data.gov/dataset/nutrition-physical-activity-and-obesity-behavioral-risk-factor-surveillance-system" target="_blank">Nutrition, Physical Activity, and Obesity - Behavioral Risk Factor Surveillance System data set</a> from the CDC. The data is originally gathered to track behavioral risk factors across different demographic strata by state.
<br>
The data about party affilation by state came from the <a href="http://www.pewforum.org/religious-landscape-study/compare/party-affiliation/by/state/" target="_blank">Party affiliation by State (2014)</a> data set provided by the Pew Research Center. This particular data was originally collected as part of the <a href="http://www.pewforum.org/religious-landscape-study/" target="_blank">Religious Landscape Study</a>
</div>
## 3
<div class="q">	What is your dependent variable? Why are you interested in explaining it? What do you hypothesize are the major factors that influence or cause it?
</div>
<div class="a">The dependent variable is the percentage of the state pop. identfied as Republican, or Republican leaning. The variable is complex with numerous influencing factors. During the in-class explorations we have looked at potential influencing factors such as race, income, and education level on party affiliation via data from the ANES survey.
<br>
Intuitively, party affiliation could also be influenced or predicted in part by religion, affiliation of parents, place of residence, affiliation of peers in social network, or potentially to particular psychological traits such as openness.
<br>
In this study, we'll be looking at the percentage of each state's pop. exhibiting particular health behaviors, discussed further below. The decision to lead a sedentary lifestyle (assuming its a choice) could be due to lack of exposure to quality health related information while in the education system and/or lack of exposure to quality health related information sources. It could also be related to lack of access to health care services, medical professionals etc. If a person is living a lifestyle that involves behaviors identified as risk factors, there are often concurrent cognitive indicators resulting from poor health. 
<br>For example, there's evidence relating <a href="https://scholar.google.com/scholar?q=physical+exercise+and+executive+function&hl=en&as_sdt=0&as_vis=1&oi=scholart&sa=X&ved=0ahUKEwiDprWHwKvXAhWD5iYKHatJCmAQgQMIJDAA" target="_blank">physical exercise and executive function</a>, and <a href="https://scholar.google.com/scholar?hl=en&as_sdt=0%2C22&as_vis=1&q=physical+activity+on+cognition&oq=physical+exercise+and+executive+function" target="_blank">physical exercise to cognition</a>. Thus, there might be some explanatory value in relating activity levels (or lack thereof) to political party affiliation that would undoubtedly be controversial if the evidence exists. 
</div>
## 4
<div class="q">	What are your independent variables, and why have you chosen these? Prior to running your regression, what effects do you expect them to have on the dependent variable? Which of these variables do you think affect other of the independent variables, and how might that affect your final results?
</div>
<div class="a">
This brief analysis will look at whether there is correlation between the following independent variables:
<ul style="list-style-type:none">
<li>$x_1$: % of pop. living sedentary lifestyle</li>
<li>$x_2$: % of pop. living lifestyle meeting minimum physical activity recommendations</li>
<li>$x_3$: % of pop. that consumes vegetables less than 1 time daily</li>
</ul>
and the dependent variable $y$: the identification as Republican.
<br>
There might be a positive correlation between the percent of a state's pop. that exhibits health behaviors identified as risk factors $x_1,x_3$ and the percent of a state's pop. that identifies as Republican or Republican leaning. There is likely an inverse colinear relationship between $x_1$ and $x_2$ because they are mutually exclusive categories along a scale of 5 categories (not all of which are mutually exclusive.) See variable Qs, for the original categories. There could also be a correlation between states with a larger percentage of the population meeting minimum physical activity recommendations, and those whom are consuming vegetables more than 1 time a day, due to a theoretical common variable of health knowledge. The linear regression will be affected --insert answer here--


</div>
## 5
<div class="q">	Explain and show in detail how you rename and recode the variables you are examining, and what units each are measured in.
</div>
<div class="a">
The variables have been recoded in the chunks entitled "Xform Datatset 1" & "Xform Datatset 2." The renaming and recoding procedures are explained below:
*Dataset 1*
The data is filtered for the year 2015, the only year with data for each question that is closest to the year in which the data was gathered in dataset 2, the relevant questions, the 50 states plus the District of Columbia (as in dataset 2), and the gender stratification. The "Questions" column from the original dataset is renamed Hlth_M (Health Measures). The percentages of the pop. reporting a yes to the question are filtered by the gender stratification, such that only 2 percentages need be averaged to get a single % for the entire population. The answers to the questions are then recoded using the forcats package as follows:
<ol>
<li>"0"="Percent of adults who engage in no leisure-time physical activity." Referred to as sedentary lifestyle above.</li>
<li>"150"="Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)." Referred to as minimum exercise recommendations above.</li>
<li>"Veg"="Percent of adults who report consuming vegetables less than one time daily."</li>
<li>"Wgt"="Percent of adults aged 18 years and older who have an overweight classification." Removed from experiment due to no correlation.</li>
</ol>
The factors are the spread into columns.  
*Dataset 2*
The dataset variables were transformed as follows:
<ol>
<li>R="Republican/Republican Leaning"</li>
<li>D="Democrat/Democrat Leaning"</li>
<li>N="No affiliation"</li>
</ol>
The variables were reclassed to characters or numbers where necessary. The tables are joined by State.
</div>

## 6
<div class="q">	Before running a multiple regression, run a few bivariate regressions of Y on some of your X variables. What do you infer? Which of these do you think might change with the addition of multiple variables?
</div>
<div class="a">
```{r '2-Var Regressions'}
summary(lm(`R`~`0`,Pty_Hlth))
summary(lm(`R`~`150`,Pty_Hlth))
summary(lm(`R`~`Veg`,Pty_Hlth))
```

</div>
## 7
<div class="q">	Run your full multiple regression using lm() and present your results using the output from the stargazer R package. Interpret the coefficients. What do they tell you substantively? Which variables seem to have the biggest substantive impact? Which ones could you actually change with some intervention, and how big a difference do you think that could make?
</div>
<div class="a">
</div>
## 8
<div class="q">	How have any of the coefficients changed from the bivariate regressions? What can you infer from that? How do you think your various independent variables interact and affect each other? Try to find an example where a variable appears signficant in the bivariate regression, but not in the full regression. Is this an example of a spurious or a chained causal pathway?
</div>
<div class="a">
</div>
## 9
<div class="q">	How does what you see match, or not, your hypotheses from (4)? Why did/didn’t it match what you expected?</div>
<div class="a">
</div>
## 10
<div class="q">	What do the $R^2$ and adjusted $R^2$ tell you about your model?</div>
<div class="a">
</div>
## 11
<div class="q">	How would you use one of the variable selection methods to choose a model with fewer variables? Select one of the methods (either one of the stepwise or criterion-based methods) and show which variables it would lead you to keep. Do you agree with its results?
</div>
<div class="a">
</div>
## 12
<div class="q">	What are your overall conclusions? What are the weaknesses of your results, and how could you improve them with better or different data?
</div>
<div class="a">
</div>
## 13
<div class="q">	Calculations (using R):
a.	Derive the coefficients from your regression using the (X0X)−1X0Y formula. (If you run into problems using solve(), try using ginv() instead, which does the same thing but is a bit more robust.)
b.	For one of the coefficients, confirm its p value as shown in the regression output using the coeffcient, its standard error, and pt() in R.
c.	Calculate the R2 and adjusted R2 using R, and confirm that your results match the regression output.
d.	Calulate the F statistic using R and confirm it against the regression output.
</div>
<div class="a">
</div>
## 14
<div class="q">	Add at least one quadratic term into your model and interpret the results. Is it significant? What is the effect of a 1-unit increase in that variable at its mean value?</div>
<div class="a">
</div>
## 15
<div class="q">	Add at least one interaction term to you model and interpret the results. Is it significant? What is the effect of a 1-unit increase in one of those interacted variables holding the other at its mean value?</div>
<div class="a">
</div>
## 16
<div class="q">	Test either the model in 14 or the model in 15 using the F test for nested models. That is, estimate the full model with the variable and quadratic term, or the variable and interaction, and then estimate the reduced model without either, and run the F test to establish whether those variables significantly improve your model.</div>
<div class="a">
</div>

